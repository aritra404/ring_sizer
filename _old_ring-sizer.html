<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Aurum Ring Sizer â€” Precision Jewelry Measurement</title>
<meta name="theme-color" content="#0e0b07">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --g:#c9a84c;--gh:#e8cf7a;--gl:#7a5c18;--gg:rgba(201,168,76,.16);--gw:rgba(201,168,76,.42);
  --bg:#faf7f0;--bg2:#f0ebe0;--ink:#18120a;--ink2:#4a3a22;--ink3:#8a7055;
  --panel:rgba(255,255,255,.95);--bdr:rgba(201,168,76,.2);--cvbg:#ede6d6;
  --w:#fff;--green:#2a9650;--greenbg:rgba(42,150,80,.1);
  --sh:0 2px 18px rgba(0,0,0,.07);--shL:0 8px 40px rgba(0,0,0,.11);
  --H:60px;--ease:cubic-bezier(.4,0,.2,1)
}
[data-dark]{
  --bg:#0f0c08;--bg2:#1a1510;--ink:#f0e8d8;--ink2:#b8a888;--ink3:#7a6848;
  --panel:rgba(16,12,7,.97);--bdr:rgba(201,168,76,.22);--cvbg:#18140e;
  --w:#1a1510;--sh:0 2px 18px rgba(0,0,0,.45);--shL:0 8px 40px rgba(0,0,0,.6)
}
html,body{height:100%}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--ink);min-height:100%;overflow-x:hidden;transition:background .3s,color .3s}

/* HEADER */
#hdr{position:fixed;top:0;left:0;right:0;z-index:300;height:var(--H);
  display:flex;align-items:center;justify-content:space-between;padding:0 18px;
  background:var(--panel);backdrop-filter:blur(18px);border-bottom:1px solid var(--bdr);transition:background .3s}
.logo{display:flex;align-items:center;gap:9px;cursor:pointer;user-select:none}
.logo-ring{width:28px;height:28px;border-radius:50%;border:2px solid var(--g);
  background:linear-gradient(135deg,var(--gl),var(--g));display:flex;align-items:center;justify-content:center}
.logo-ring svg{width:13px;height:13px;fill:#fff}
.logo-name{font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:600;letter-spacing:.1em;color:var(--ink)}
.logo-name b{color:var(--g)}
.hdr-r{display:flex;align-items:center;gap:6px}
#cbadge{display:flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;
  font-size:11px;font-weight:500;cursor:pointer;border:1px solid;transition:all .2s}
#cbadge.ok{background:var(--greenbg);border-color:rgba(42,150,80,.3);color:var(--green)}
#cbadge.bad{background:var(--gg);border-color:rgba(201,168,76,.3);color:var(--gl);animation:blink 2s infinite}
@keyframes blink{50%{opacity:.6}}
#cbadge .dot{width:6px;height:6px;border-radius:50%;background:currentColor}
.ibtn{width:34px;height:34px;border-radius:8px;border:1px solid var(--bdr);
  background:transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;
  color:var(--ink3);transition:all .2s}
.ibtn:hover{background:var(--g);color:#fff;border-color:var(--g)}
.ibtn svg{width:15px;height:15px}

/* SCREENS */
.scr{display:none;min-height:100vh;padding-top:var(--H)}
.scr.on{display:block;animation:fu .38s var(--ease) both}
#s-meas{display:none;height:100vh;padding-top:var(--H);flex-direction:column}
#s-meas.on{display:flex}
@keyframes fu{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

/* LANDING */
#s-land{display:flex;flex-direction:column;align-items:center;justify-content:center;
  text-align:center;padding:56px 20px 64px;gap:0}
.hero{width:164px;height:164px;position:relative;margin-bottom:32px;animation:float 3.5s ease-in-out infinite}
@keyframes float{50%{transform:translateY(-10px)}}
.hero .r1{position:absolute;inset:0;border-radius:50%;border:2.5px solid var(--g);
  box-shadow:0 0 48px var(--gw),inset 0 0 20px rgba(201,168,76,.04)}
.hero .r2{position:absolute;inset:21px;border-radius:50%;border:1px solid rgba(201,168,76,.22)}
.hero .r3{position:absolute;inset:53px;border-radius:50%;border:1px dashed rgba(201,168,76,.18)}
.sp{position:absolute;background:var(--gh);
  clip-path:polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%)}
.sp1{width:7px;height:7px;top:9px;right:27px;animation:tw 2.4s 0s infinite}
.sp2{width:9px;height:9px;bottom:14px;left:14px;animation:tw 2.4s .9s infinite}
.sp3{width:5px;height:5px;top:36px;left:6px;animation:tw 2.4s 1.7s infinite}
@keyframes tw{0%,100%{opacity:0;transform:scale(.4) rotate(0deg)}50%{opacity:1;transform:scale(1) rotate(180deg)}}
.ey{font-size:10px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;color:var(--g);margin-bottom:9px}
.h1{font-family:'Cormorant Garamond',serif;font-size:clamp(30px,5.5vw,54px);font-weight:300;line-height:1.1;color:var(--ink);margin-bottom:6px}
.h1 i{font-style:italic;color:var(--g)}
.sub{font-size:14px;color:var(--ink3);margin-bottom:26px;line-height:1.65;max-width:390px}
.pills{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-bottom:28px}
.pill{display:flex;align-items:center;gap:5px;padding:5px 11px;border-radius:20px;
  border:1px solid var(--bdr);background:var(--panel);font-size:12px;color:var(--ink3)}
.pill svg{width:12px;height:12px;color:var(--g)}
.btn-g{display:inline-flex;align-items:center;gap:9px;padding:14px 32px;border-radius:50px;
  background:linear-gradient(135deg,var(--gl) 0%,var(--g) 55%,var(--gh) 100%);
  color:#fff;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;
  letter-spacing:.06em;text-transform:uppercase;border:none;cursor:pointer;
  box-shadow:0 4px 22px var(--gw);transition:all .25s}
.btn-g:hover{transform:translateY(-2px);box-shadow:0 8px 32px var(--gw)}
.btn-g svg{width:16px;height:16px}
.btn-sk{display:inline-flex;align-items:center;gap:7px;padding:10px 20px;border-radius:50px;
  margin-top:10px;border:1px solid var(--bdr);background:transparent;color:var(--ink3);
  font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;cursor:pointer;transition:all .25s}
.btn-sk:hover{border-color:var(--g);color:var(--g)}
.btn-sk svg{width:13px;height:13px}

/* CALIBRATION â€” Credit Card Method */
#s-calib{display:flex;flex-direction:column;align-items:center;min-height:calc(100vh - var(--H));
  background:var(--bg);overflow:hidden}

/* Step indicator */
.cal-steps{display:flex;align-items:center;gap:0;padding:14px 20px 0;width:100%;max-width:520px}
.cal-step{display:flex;align-items:center;gap:6px;font-size:11px;font-weight:700;
  letter-spacing:.1em;text-transform:uppercase;color:var(--ink3);opacity:.4;transition:opacity .3s}
.cal-step.on{opacity:1;color:var(--g)}
.cal-step-n{width:22px;height:22px;border-radius:50%;border:1.5px solid currentColor;
  display:flex;align-items:center;justify-content:center;font-size:10px;flex-shrink:0}
.cal-step-div{flex:1;height:1px;background:var(--bdr);margin:0 8px}

/* Card arena â€” full-width interactive zone */
#card-arena{position:relative;width:100%;flex:1;display:flex;align-items:center;
  justify-content:center;overflow:hidden;touch-action:none;
  background:repeating-linear-gradient(0deg,rgba(201,168,76,.04) 0px,rgba(201,168,76,.04) 1px,transparent 1px,transparent 40px),
             repeating-linear-gradient(90deg,rgba(201,168,76,.04) 0px,rgba(201,168,76,.04) 1px,transparent 1px,transparent 40px);
  min-height:220px}

/* The card rectangle â€” thin 1px border, resizable via JS */
#cal-card{position:absolute;border:1px solid var(--g);border-radius:5px;
  box-shadow:0 0 0 1px rgba(0,0,0,.08),0 0 20px rgba(201,168,76,.12);
  background:rgba(201,168,76,.03);pointer-events:none;transition:none}
/* Corner marks */
#cal-card::before,#cal-card::after{content:'';position:absolute;
  width:12px;height:12px;border-color:var(--g);border-style:solid}
#cal-card::before{top:-1px;left:-1px;border-width:2px 0 0 2px;border-radius:4px 0 0 0}
#cal-card::after{bottom:-1px;right:-1px;border-width:0 2px 2px 0;border-radius:0 0 4px 0}

/* Resize handle â€” right edge */
#card-handle{position:absolute;right:-14px;top:50%;transform:translateY(-50%);
  width:28px;height:44px;border-radius:8px;
  background:linear-gradient(135deg,var(--gl),var(--g));
  display:flex;align-items:center;justify-content:center;
  cursor:ew-resize;touch-action:none;
  box-shadow:0 2px 12px var(--gw)}
#card-handle svg{width:14px;height:14px;fill:#fff}

/* Dimension label on card */
#card-label{position:absolute;bottom:-26px;left:50%;transform:translateX(-50%);
  font-size:11px;font-weight:700;color:var(--g);white-space:nowrap;
  background:var(--bg);padding:2px 6px;border-radius:4px;letter-spacing:.04em}

/* Control bar below arena */
.cal-bar{width:100%;max-width:520px;padding:14px 16px;display:flex;flex-direction:column;gap:10px}
.cal-bar-title{font-size:10px;font-weight:700;letter-spacing:.18em;text-transform:uppercase;color:var(--g)}
.cal-instruction{font-size:13px;color:var(--ink3);line-height:1.6}
.cal-instruction b{color:var(--ink)}
.fine-row{display:flex;align-items:center;gap:8px}
.fine-row label{font-size:11px;color:var(--ink3);white-space:nowrap;min-width:80px}
.fine-sl{flex:1;height:4px;border-radius:2px;accent-color:var(--g)}
.fine-num{font-size:12px;font-weight:700;color:var(--ink);min-width:50px;text-align:right}

/* Debug readout */
.dbg{background:rgba(201,168,76,.07);border:1px solid rgba(201,168,76,.18);
  border-radius:10px;padding:11px 13px;font-size:11px;line-height:1.8;
  font-family:'DM Sans',monospace;color:var(--ink3);display:none}
.dbg b{color:var(--g)}

/* CTA buttons */
.cal-cta{display:flex;gap:8px;width:100%;max-width:520px;padding:0 16px 20px}
.btn-ol{padding:11px;border-radius:9px;border:1px solid var(--bdr);background:transparent;
  color:var(--ink3);font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;
  cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:5px}
.btn-ol:hover{border-color:var(--g);color:var(--g)}
.btn-ol svg{width:13px;height:13px}
.btn-sl{flex:1;padding:13px;border-radius:9px;border:none;
  background:linear-gradient(135deg,var(--gl),var(--g));color:#fff;
  font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;
  letter-spacing:.04em;text-transform:uppercase;cursor:pointer;transition:all .2s;
  display:flex;align-items:center;justify-content:center;gap:6px}
.btn-sl:hover{transform:translateY(-1px);box-shadow:0 4px 16px var(--gw)}
.btn-sl svg{width:14px;height:14px}
.reset-lnk{display:block;text-align:center;padding-bottom:8px;font-size:12px;
  color:var(--ink3);cursor:pointer;text-decoration:underline;transition:color .2s}
.reset-lnk:hover{color:#c0392b}

/* misc shared */
.gline{height:1px;background:linear-gradient(90deg,transparent,var(--gg),transparent);margin:10px 0}
.hint{font-size:11px;color:var(--ink3);margin-top:4px;line-height:1.5}

/* MEASURE */
.mwrap{flex:1;display:grid;grid-template-columns:1fr 340px;min-height:0;overflow:hidden}
@media(max-width:860px){.mwrap{grid-template-columns:1fr;grid-template-rows:1fr auto}}

#cvp{position:relative;overflow:hidden;background:var(--cvbg);cursor:default;
  display:flex;align-items:center;justify-content:center;transition:background .3s}
#cvp::before{content:'';position:absolute;inset:0;pointer-events:none;
  background-image:linear-gradient(rgba(201,168,76,.08) 1px,transparent 1px),
    linear-gradient(90deg,rgba(201,168,76,.08) 1px,transparent 1px);
  background-size:40px 40px}
#cvs{position:absolute;inset:0;width:100%;height:100%;touch-action:none}
.cv-tl{position:absolute;top:13px;left:13px;background:var(--panel);
  backdrop-filter:blur(10px);border:1px solid var(--bdr);border-radius:7px;
  padding:5px 10px;font-size:12px;font-weight:600;color:var(--ink3);pointer-events:none}
#zbadge{top:13px;left:auto;right:13px;display:none}
.cv-hint{position:absolute;bottom:13px;left:50%;transform:translateX(-50%);
  background:var(--panel);backdrop-filter:blur(10px);border:1px solid var(--bdr);
  border-radius:20px;padding:7px 14px;font-size:12px;color:var(--ink3);
  display:flex;align-items:center;gap:6px;white-space:nowrap;pointer-events:none}
.cv-hint svg{width:12px;height:12px;color:var(--g);flex-shrink:0}

/* No-calibration overlay */
#nocal-overlay{position:absolute;inset:0;background:rgba(var(--bg-rgb,250,247,240),.85);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:10px;text-align:center;padding:24px;backdrop-filter:blur(4px)}
#nocal-overlay p{font-size:14px;color:var(--ink3);line-height:1.6;max-width:280px}
#nocal-overlay.hide{display:none}

.mbar{display:none;align-items:center;gap:9px;padding:11px 14px;
  background:var(--panel);backdrop-filter:blur(12px);border-top:1px solid var(--bdr)}
@media(max-width:860px){.mbar{display:flex}}
.mbar-num{font-family:'Cormorant Garamond',serif;font-size:24px;font-weight:600;
  color:var(--ink);min-width:72px;text-align:center}
.mbar-u{font-size:11px;color:var(--ink3)}

/* RESULTS PANEL */
#rp{background:var(--panel);backdrop-filter:blur(16px);border-left:1px solid var(--bdr);
  overflow-y:auto;display:flex;flex-direction:column;gap:10px;padding:14px;transition:background .3s}
@media(max-width:860px){#rp{border-left:none;border-top:1px solid var(--bdr);max-height:47vh}}
.pc{background:var(--w);border:1px solid var(--bdr);border-radius:13px;padding:14px;transition:background .3s}
.pch{display:flex;align-items:center;gap:5px;font-size:10px;font-weight:700;
  letter-spacing:.16em;text-transform:uppercase;color:var(--g);margin-bottom:12px}
.pch svg{width:12px;height:12px}
.bignum{display:flex;align-items:baseline;gap:3px;margin-bottom:10px}
.bignum .n{font-family:'Cormorant Garamond',serif;font-size:50px;font-weight:600;line-height:1;color:var(--ink)}
.bignum .u{font-size:15px;color:var(--ink3)}

input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:5px;
  border-radius:3px;outline:none;cursor:pointer;
  background:linear-gradient(90deg,var(--g) 0%,var(--g) var(--p,25%),rgba(201,168,76,.2) var(--p,25%));
  margin:6px 0}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;
  border-radius:50%;background:linear-gradient(135deg,var(--gl),var(--g));
  box-shadow:0 2px 10px var(--gw);cursor:pointer;transition:transform .15s}
input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.2)}
input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;border:none;
  background:linear-gradient(135deg,var(--gl),var(--g));box-shadow:0 2px 10px var(--gw);cursor:pointer}

.frow{display:flex;gap:4px;align-items:center;margin-top:8px;flex-wrap:wrap}
.fb{flex:1;min-width:0;padding:8px 4px;border-radius:8px;border:1.5px solid var(--bdr);
  background:var(--w);color:var(--ink);font-size:12px;font-weight:700;
  font-family:'DM Sans',sans-serif;cursor:pointer;transition:all .18s;white-space:nowrap}
.fb:hover{background:var(--g);color:#fff;border-color:var(--g)}
.fm{font-size:10px;color:var(--ink3);text-align:center;flex-shrink:0;padding:0 2px}

.mg{display:grid;grid-template-columns:1fr 1fr;gap:7px}
.mi{background:rgba(201,168,76,.05);border:1px solid rgba(201,168,76,.12);
  border-radius:9px;padding:10px;text-align:center}
.mi.wide{grid-column:1/-1}
.mv{font-family:'Cormorant Garamond',serif;font-size:21px;font-weight:600;color:var(--ink);display:block}
.ml{font-size:10px;text-transform:uppercase;letter-spacing:.1em;color:var(--ink3)}

.zt{width:100%;border-collapse:collapse}
.zt th{font-size:10px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  color:var(--ink3);padding:5px 6px;border-bottom:1px solid var(--bdr);text-align:left}
.zt th:last-child{text-align:right}
.zt td{padding:9px 6px;border-bottom:1px solid rgba(201,168,76,.07);font-size:13px;color:var(--ink3)}
.zt tr:last-child td{border-bottom:none}
.zt tr:hover td{background:rgba(201,168,76,.04)}
.zn{font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:600;
  background:linear-gradient(135deg,var(--gl),var(--g));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  background-clip:text;display:block;text-align:right}

.tg2{display:grid;grid-template-columns:1fr 1fr;gap:7px}
.tg{display:flex;align-items:center;gap:6px;padding:8px 10px;border-radius:8px;
  border:1.5px solid var(--bdr);background:var(--w);cursor:pointer;
  font-size:12px;font-weight:500;color:var(--ink3);transition:all .2s}
.tg.on{border-color:var(--g);background:rgba(201,168,76,.08);color:var(--gl)}
.tg svg{width:12px;height:12px;flex-shrink:0}

.eg2{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:7px}
.eb{display:flex;align-items:center;justify-content:center;gap:5px;padding:9px;
  border-radius:8px;border:1.5px solid var(--bdr);background:var(--w);cursor:pointer;
  font-size:12px;font-weight:500;color:var(--ink);font-family:'DM Sans',sans-serif;transition:all .2s}
.eb:hover{border-color:var(--g);color:var(--gl);transform:translateY(-1px)}
.eb svg{width:12px;height:12px}
.ef{width:100%;display:flex;align-items:center;justify-content:center;gap:6px;padding:11px;
  border-radius:8px;border:none;background:linear-gradient(135deg,var(--gl),var(--g));
  color:#fff;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;
  letter-spacing:.04em;text-transform:uppercase;cursor:pointer;transition:all .2s}
.ef:hover{transform:translateY(-1px);box-shadow:0 4px 16px var(--gw)}
.ef svg{width:13px;height:13px}

.ibox{display:flex;align-items:flex-start;gap:7px;padding:9px 11px;border-radius:8px;
  background:rgba(30,58,110,.06);border:1px solid rgba(30,58,110,.12);
  font-size:11px;line-height:1.5;color:#3a5a9a}
.ibox svg{width:12px;height:12px;flex-shrink:0;margin-top:1px}

/* TOAST */
#toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(60px);
  background:var(--ink);color:var(--bg);padding:10px 20px;border-radius:20px;
  font-size:13px;font-weight:500;z-index:999;pointer-events:none;white-space:nowrap;
  box-shadow:var(--shL);transition:transform .3s var(--ease)}
#toast.on{transform:translateX(-50%) translateY(0)}

/* FS BAR */
#fsbar{display:none;align-items:center;justify-content:center;gap:9px;
  padding:7px 14px;font-size:12px;color:var(--ink3);
  background:var(--gg);border-bottom:1px solid rgba(201,168,76,.2)}
#fsbar.on{display:flex}
#fsbar button{padding:3px 10px;border-radius:5px;border:none;
  background:var(--g);color:#fff;font-size:11px;font-weight:700;cursor:pointer}
#fsbar .xb{background:transparent;color:var(--ink3);border:1px solid var(--bdr);
  font-size:15px;line-height:1;padding:2px 7px}

::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-thumb{background:rgba(201,168,76,.28);border-radius:3px}
</style>
</head>
<body>

<!-- HEADER -->
<header id="hdr">
  <div class="logo" onclick="go('land')">
    <div class="logo-ring">
      <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"/></svg>
    </div>
    <span class="logo-name">AURUM <b>SIZER</b></span>
  </div>
  <div class="hdr-r">
    <div id="cbadge" class="bad" onclick="go('calib')">
      <div class="dot"></div><span id="cbtxt">Not Calibrated</span>
    </div>
    <button class="ibtn" title="Dark mode" onclick="tDark()">
      <svg id="dico" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/></svg>
    </button>
    <button class="ibtn" title="Fullscreen" onclick="tFS()">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
    </button>
  </div>
</header>

<!-- FS BAR -->
<div id="fsbar">
  <svg viewBox="0 0 24 24" fill="currentColor" style="width:12px;height:12px;color:var(--g)"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
  Fullscreen gives best accuracy
  <button onclick="tFS()">Enter Fullscreen</button>
  <button class="xb" onclick="document.getElementById('fsbar').classList.remove('on')">Ã—</button>
</div>

<div id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• LANDING â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="scr on" id="s-land">
  <div class="hero">
    <div class="r1"></div><div class="r2"></div><div class="r3"></div>
    <div class="sp sp1"></div><div class="sp sp2"></div><div class="sp sp3"></div>
  </div>
  <p class="ey">Professional Jewelry Tool</p>
  <h1 class="h1">Find Your <i>Perfect</i><br>Ring Size</h1>
  <p class="sub">Place any ring flat on your screen, match the adjustable circle to its inner edge, and get your exact size in Indian, US, UK, and EU standards.</p>
  <div class="pills">
    <span class="pill"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>Â±0.3mm Accuracy</span>
    <span class="pill"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4v16h16V4zm-5 11H7v-2h8v2zm2-4H7V9h10v2z"/></svg>4 Size Systems</span>
    <span class="pill"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>100% Private</span>
    <span class="pill"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99z"/></svg>Any Device</span>
  </div>
  <button class="btn-g" onclick="go('calib')">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58z"/></svg>
    Calibrate &amp; Start
  </button>
  <div id="skip-wrap" style="display:none">
    <button class="btn-sk" onclick="go('meas')">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/></svg>
      Skip â€” use saved calibration
    </button>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• CALIBRATION â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="scr" id="s-calib">

  <!-- Step indicator -->
  <div class="cal-steps">
    <div class="cal-step on" id="cstep1">
      <div class="cal-step-n">1</div><span>Calibrate</span>
    </div>
    <div class="cal-step-div"></div>
    <div class="cal-step" id="cstep2">
      <div class="cal-step-n">2</div><span>Measure Ring</span>
    </div>
  </div>

  <!-- Interactive card arena -->
  <div id="card-arena">
    <div id="cal-card">
      <div id="card-handle">
        <svg viewBox="0 0 24 24"><path d="M8 5h2v14H8zm6 0h2v14h-2z"/></svg>
      </div>
      <div id="card-label">â€” mm</div>
    </div>
  </div>

  <!-- Controls -->
  <div class="cal-bar">
    <div class="cal-bar-title">
      <svg viewBox="0 0 24 24" fill="currentColor" style="width:11px;height:11px;vertical-align:middle;margin-right:4px"><path d="M20 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg>
      Credit Card Calibration
    </div>
    <p class="cal-instruction">
      Place a <b>credit or debit card</b> flat on your screen. Drag the <b>gold handle</b> on the right edge until the gold rectangle exactly matches your card's width. Then use the fine slider for precise alignment.
    </p>

    <!-- Fine adjustment slider -->
    <div class="fine-row">
      <label>Fine adjust</label>
      <input type="range" class="fine-sl" id="card-fine"
        min="50" max="600" step="1" oninput="onFineSlider(+this.value)">
      <span class="fine-num" id="fine-disp">â€” px</span>
    </div>

    <!-- Debug readout -->
    <div class="dbg" id="cal-dbg">
      <b>card_width_px</b> = <span id="dbg-cwpx">â€”</span> CSS px<br>
      <b>mm_per_pixel</b> &nbsp;= <span id="dbg-mpp">â€”</span> mm/px<br>
      <b>card renders as</b> = <span id="dbg-mm">â€”</span> mm wide (should be 85.60)
    </div>

    <div class="gline"></div>
  </div>

  <div class="cal-cta">
    <button class="btn-ol" onclick="go('land')">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
      Back
    </button>
    <button class="btn-sl" onclick="doCalib()">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
      Card Matches â€” Save &amp; Measure
    </button>
  </div>
  <span class="reset-lnk" onclick="resetCalib()">Reset saved calibration</span>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MEASURE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="scr" id="s-meas">
  <div class="mwrap">
    <div id="cvp">
      <canvas id="cvs"></canvas>
      <div class="cv-tl">âŒ€ <span id="cv-d">â€”</span> mm</div>
      <div class="cv-tl" id="zbadge">2Ã— Zoom</div>
      <!-- No-calibration overlay -->
      <div id="nocal-overlay" class="hide">
        <svg viewBox="0 0 24 24" fill="var(--g)" width="40" height="40"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
        <p>Calibrate your screen first so measurements are accurate in real millimetres.</p>
        <button class="btn-g" style="padding:11px 22px;font-size:13px" onclick="go('calib')">Calibrate Now</button>
      </div>
      <div class="cv-hint">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
        Drag the gold handle or use the slider
      </div>
    </div>

    <!-- Mobile bar -->
    <div class="mbar">
      <button class="fb" style="flex:0 0 36px;height:36px;border-radius:8px" onclick="nudge(-0.1)">âˆ’</button>
      <input type="range" id="msl" min="5" max="40" step="0.1" style="flex:1" oninput="setD(+this.value)">
      <button class="fb" style="flex:0 0 36px;height:36px;border-radius:8px" onclick="nudge(+0.1)">+</button>
      <div class="mbar-num"><span id="mn">â€”</span><span class="mbar-u"> mm</span></div>
    </div>

    <!-- Results panel -->
    <div id="rp">
      <!-- Control -->
      <div class="pc">
        <div class="pch">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
          Inner Diameter
        </div>
        <div class="bignum"><span class="n" id="bn">â€”</span><span class="u">mm</span></div>
        <input type="range" id="dsl" min="5" max="40" step="0.1" oninput="setD(+this.value)">
        <div class="frow">
          <button class="fb" onclick="nudge(-1)">âˆ’1</button>
          <button class="fb" onclick="nudge(-0.5)">âˆ’Â½</button>
          <button class="fb" onclick="nudge(-0.1)">âˆ’0.1</button>
          <span class="fm">mm</span>
          <button class="fb" onclick="nudge(+0.1)">+0.1</button>
          <button class="fb" onclick="nudge(+0.5)">+Â½</button>
          <button class="fb" onclick="nudge(+1)">+1</button>
        </div>
      </div>

      <!-- Measurements -->
      <div class="pc">
        <div class="pch">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 14H7v-2h8v2zm3-4H7v-2h11v2zm0-4H7V6h11v2z"/></svg>
          Measurements
        </div>
        <div class="mg">
          <div class="mi"><span class="mv" id="md">â€”</span><span class="ml">Diameter mm</span></div>
          <div class="mi"><span class="mv" id="mr">â€”</span><span class="ml">Radius mm</span></div>
          <div class="mi wide"><span class="mv" id="mc">â€”</span><span class="ml">Circumference mm</span></div>
        </div>
      </div>

      <!-- Sanity warning -->
      <div id="warn-box" style="display:none;align-items:flex-start;gap:8px;padding:10px 12px;
        border-radius:9px;background:rgba(192,57,43,.07);border:1px solid rgba(192,57,43,.25);
        font-size:12px;line-height:1.5;color:#a93226">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:14px;height:14px;flex-shrink:0;margin-top:1px"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
        <span id="warn-msg"></span>
      </div>

      <!-- Ring sizes -->
      <div class="pc">
        <div class="pch">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
          Ring Sizes
        </div>
        <table class="zt">
          <thead><tr><th>Standard</th><th>Size</th></tr></thead>
          <tbody>
            <tr><td>ðŸ‡®ðŸ‡³ Indian</td>     <td><span class="zn" id="si">â€”</span></td></tr>
            <tr><td>ðŸ‡ºðŸ‡¸ US / Canada</td><td><span class="zn" id="su">â€”</span></td></tr>
            <tr><td>ðŸ‡¬ðŸ‡§ UK / AUS</td>   <td><span class="zn" id="sk">â€”</span></td></tr>
            <tr><td>ðŸ‡ªðŸ‡º EU / ISO</td>   <td><span class="zn" id="se">â€”</span></td></tr>
          </tbody>
        </table>
      </div>

      <!-- Tools -->
      <div class="pc">
        <div class="pch">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>
          Accuracy Tools
        </div>
        <div class="tg2">
          <button class="tg" id="snaptg" onclick="tSnap()">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 11h8V3H3v8zm2-6h4v4H5V5zM3 21h8v-8H3v8zm2-6h4v4H5v-4zm8-12v8h8V3h-8zm6 6h-4V5h4v4z"/></svg>
            Snap 0.5mm
          </button>
          <button class="tg" id="zoomtg" onclick="tZoom()">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            Zoom 2Ã—
          </button>
        </div>
      </div>

      <!-- Export -->
      <div class="pc">
        <div class="pch">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
          Export &amp; Share
        </div>
        <div class="eg2">
          <button class="eb" onclick="expImg()">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
            Save PNG
          </button>
          <button class="eb" onclick="cpLink()">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
            Copy Link
          </button>
        </div>
        <button class="ef" onclick="expPDF()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3z"/></svg>
          Download PDF Report
        </button>
      </div>

      <div class="ibox">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
        Lay the ring flat on screen. Align the gold circle to the ring's inner edge. Use fullscreen for best accuracy.
      </div>

      <button class="btn-ol" style="width:100%;justify-content:center;padding:10px" onclick="go('calib')">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58z"/></svg>
        Re-calibrate Screen
      </button>
    </div>
  </div>
</section>

<script>
'use strict';

// â”€â”€â”€ RING SIZE TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// [inner_diameter_mm, indian, us, uk, eu]
const ST=[
  [12.04,'0','0','A','37'],[12.45,'Â½','Â¼','AÂ½','38'],[12.85,'1','Â½','B','39'],
  [13.26,'1','Â¾','BÂ½','40'],[13.67,'2','1','C','41'],[14.07,'2','1Â¼','CÂ½','42'],
  [14.48,'3','1Â½','D','43'],[14.88,'3','1Â¾','DÂ½','44'],[15.29,'4','2','E','45'],
  [15.70,'4','2Â¼','EÂ½','46'],[16.10,'5','2Â½','F','47'],[16.51,'5','2Â¾','FÂ½','48'],
  [16.92,'6','3','G','49'],[17.32,'7','3Â¼','GÂ½','50'],[17.73,'7','3Â½','H','51'],
  [18.14,'8','3Â¾','HÂ½','52'],[18.54,'8','4','I','53'],[18.95,'9','4Â¼','IÂ½','54'],
  [19.35,'9','4Â½','J','55'],[19.76,'10','4Â¾','JÂ½','56'],[20.17,'10','5','K','57'],
  [20.57,'11','5Â¼','KÂ½','58'],[20.98,'11','5Â½','L','59'],[21.39,'12','5Â¾','LÂ½','60'],
  [21.79,'12','6','M','61'],[22.20,'13','6Â¼','MÂ½','62'],[22.61,'13','6Â½','N','63'],
  [23.01,'14','6Â¾','NÂ½','64'],[23.42,'14','7','O','65'],[23.83,'15','7Â¼','OÂ½','66'],
  [24.23,'15','7Â½','P','67'],[24.64,'16','7Â¾','PÂ½','68'],[25.05,'16','8','Q','69'],
  [25.45,'17','8Â¼','QÂ½','70'],[25.86,'17','8Â½','R','71'],[26.27,'18','8Â¾','RÂ½','72'],
  [26.67,'18','9','S','73'],[27.08,'19','9Â¼','SÂ½','74'],[27.49,'19','9Â½','T','75'],
  [27.89,'20','9Â¾','TÂ½','76'],[28.30,'20','10','U','77'],[28.70,'21','10Â¼','UÂ½','78'],
  [29.11,'21','10Â½','V','79'],[29.52,'22','10Â¾','VÂ½','80'],[29.92,'22','11','W','81'],
  [30.33,'23','11Â¼','WÂ½','82'],[30.74,'23','11Â½','X','83'],[31.14,'24','11Â¾','XÂ½','84'],
  [31.55,'24','12','Y','85'],[31.96,'25','12Â¼','Z','86'],
  [32.36,'25','12Â½','Z+1','87'],[32.77,'26','12Â¾','Z+2','88'],
];
function sz(d){return ST.reduce((a,b)=>Math.abs(b[0]-d)<Math.abs(a[0]-d)?b:a);}

// â”€â”€â”€ CONSTANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ISO/IEC 7810 ID-1 credit card â€” physical dimensions
const CARD_W_MM = 85.60;  // primary calibration dimension
const CARD_H_MM = 53.98;

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//
// CALIBRATION MODEL (credit card method):
//   card_width_px   = CSS pixel width of rectangle when user confirms match
//   mm_per_pixel    = CARD_W_MM / card_width_px
//
// All measurements are in CSS pixels throughout.
// The canvas draws in CSS pixels (ctx.setTransform(DPR,0,0,DPR,0,0)).
// mm_per_pixel converts CSS px â†’ mm directly â€” no DPR needed.
//
// WHY THIS WORKS:
//   The browser renders CSS pixels. When user drags the card rectangle to
//   match a physical credit card, they are locking in the exact CSS-px-to-mm
//   ratio for THIS device at THIS zoom level â€” regardless of DPR, PPI, or
//   any other device-specific value.
//
const DPR       = window.devicePixelRatio || 1;
let mppCSS      = null;   // mm per CSS pixel â€” single source of truth
let card_width_px = null; // CSS px width stored at calibration
let diam        = 18.0;   // current ring diameter in mm
let snap        = false;
let zoom        = false;
let drag        = false, dy0 = 0, d0 = 18;

// â”€â”€â”€ CARD CALIBRATION STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Card rectangle position and size (CSS px)
let cardW   = 260;  // initial CSS px width (rough starting estimate)
let cardDragging = false;
let cardDragStartX = 0, cardDragStartW = 0;

// â”€â”€â”€ SCREEN ROUTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function go(id){
  document.querySelectorAll('.scr').forEach(s => s.classList.remove('on'));
  document.getElementById('s-'+id).classList.add('on');
  if(id === 'meas'){
    setTimeout(initCvs, 50);
    document.getElementById('fsbar').classList.add('on');
    document.getElementById('nocal-overlay').classList.toggle('hide', !!mppCSS);
  }
  if(id === 'calib') initCalib();
  if(id === 'land')  chkSaved();
  window.scrollTo(0, 0);
}

// â”€â”€â”€ CALIBRATION INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initCalib(){
  // Restore saved card width or compute a reasonable starting estimate.
  // We want the card to appear roughly correct so the user only needs fine-tune.
  const saved = parseFloat(localStorage.getItem('a_cwpx'));
  if(saved > 0){
    cardW = saved;
  } else {
    // Seed: use screen.width * 0.7 as a starting width estimate,
    // clamped to a sensible range. User will adjust to match real card.
    cardW = clamp(Math.round(window.screen.width * 0.7), 120, 560);
  }
  positionCard();
  updateCalibUI();
  // Attach drag to handle â€” replace to avoid stale listeners
  const handle = document.getElementById('card-handle');
  const nh = handle.cloneNode(true);
  handle.parentNode.replaceChild(nh, handle);
  nh.addEventListener('mousedown',  cardMD);
  nh.addEventListener('touchstart', e => { e.preventDefault(); cardMD(e.touches[0]); }, {passive:false});
  document.addEventListener('mousemove',  cardMM);
  document.addEventListener('mouseup',    cardMU);
  document.addEventListener('touchmove',  e => { if(cardDragging){ e.preventDefault(); cardMM(e.touches[0]); }}, {passive:false});
  document.addEventListener('touchend',   cardMU);
  // Sync fine slider
  const sl = document.getElementById('card-fine');
  sl.min   = Math.round(window.screen.width * 0.15);
  sl.max   = Math.round(window.screen.width * 1.1);
  sl.value = cardW;
}

function positionCard(){
  const arena  = document.getElementById('card-arena');
  const card   = document.getElementById('cal-card');
  const handle = card.querySelector('#card-handle') || document.getElementById('card-handle');
  const aW = arena.clientWidth  || window.innerWidth;
  const aH = arena.clientHeight || 220;
  // Card height locked to maintain 85.60:53.98 ratio
  const cardH = Math.round(cardW * CARD_H_MM / CARD_W_MM);
  card.style.width  = cardW  + 'px';
  card.style.height = cardH  + 'px';
  card.style.left   = Math.round((aW - cardW) / 2) + 'px';
  card.style.top    = Math.round((aH - cardH) / 2) + 'px';
}

function updateCalibUI(){
  // mm_per_pixel = CARD_W_MM / card_width_px
  const mpp = CARD_W_MM / cardW;
  const cardH = Math.round(cardW * CARD_H_MM / CARD_W_MM);
  // Label on card
  const lbl = document.getElementById('card-label');
  if(lbl) lbl.textContent = cardW + ' px Â· ' + CARD_W_MM.toFixed(2) + 'mm';
  // Fine slider sync
  const sl = document.getElementById('card-fine');
  if(sl) sl.value = cardW;
  document.getElementById('fine-disp').textContent = cardW + ' px';
  // Debug readout
  document.getElementById('dbg-cwpx').textContent = cardW;
  document.getElementById('dbg-mpp').textContent  = mpp.toFixed(6);
  document.getElementById('dbg-mm').textContent   = (cardW * mpp).toFixed(2);
  document.getElementById('cal-dbg').style.display = 'block';
  positionCard();
}

// Card resize drag handlers
function cardMD(e){
  cardDragging   = true;
  cardDragStartX = e.clientX;
  cardDragStartW = cardW;
}
function cardMM(e){
  if(!cardDragging) return;
  const dx  = e.clientX - cardDragStartX;
  // Moving right â†’ wider; moving left â†’ narrower
  // Card is centred, so dragging the RIGHT handle by dx â†’ card widens by dx
  cardW = clamp(Math.round(cardDragStartW + dx), 80, Math.round(window.screen.width * 1.1));
  updateCalibUI();
}
function cardMU(){ cardDragging = false; }

// Fine slider
function onFineSlider(v){
  cardW = Math.round(v);
  updateCalibUI();
}

// â”€â”€â”€ CALIBRATION SAVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doCalib(){
  if(cardW <= 0){
    toast('âš  Adjust the card rectangle first');
    return;
  }

  // â”€â”€ STEP 2: card_width_px confirmed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  card_width_px = cardW;   // CSS pixels

  // â”€â”€ STEP 3: mm_per_pixel = 85.60 / card_width_px â”€â”€â”€â”€
  // This is the ONLY formula used. No PPI, no DPR, no screen inches.
  mppCSS = CARD_W_MM / card_width_px;

  // â”€â”€ STEP 9: persist â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const device_id = (navigator.userAgent + window.screen.width + 'x' + window.screen.height).slice(0, 80);
  localStorage.setItem('a_mppCSS',  mppCSS);
  localStorage.setItem('a_cwpx',    card_width_px);
  localStorage.setItem('a_dev_id',  device_id);
  localStorage.setItem('a_ts',      Date.now());

  // Debug log
  console.log('[Aurum Card Calibration]');
  console.log('  card_width_px          =', card_width_px, 'CSS px');
  console.log('  mm_per_pixel (mppCSS)  =', mppCSS.toFixed(6));
  console.log('  ring_diameter_px       = diameter_mm /', mppCSS.toFixed(6));
  console.log('  diameter_mm_check      =', (card_width_px * mppCSS).toFixed(4), '(should be 85.60)');

  setBadge(true);
  toast('âœ“ Calibrated â€” ' + mppCSS.toFixed(5) + ' mm/px Â· card=' + card_width_px + 'px');
  setTimeout(() => go('meas'), 600);
}

function resetCalib(){
  ['a_mppCSS','a_cwpx','a_dev_id','a_ts'].forEach(k => localStorage.removeItem(k));
  mppCSS = null; card_width_px = null;
  setBadge(false);
  toast('Calibration reset');
}

function chkSaved(){
  const sv  = localStorage.getItem('a_mppCSS');
  const svW = localStorage.getItem('a_cwpx');
  const sw  = document.getElementById('skip-wrap');
  if(sv && svW){
    mppCSS        = parseFloat(sv);
    card_width_px = parseFloat(svW);
    setBadge(true);
    if(sw) sw.style.display = 'block';
  } else {
    setBadge(false);
    if(sw) sw.style.display = 'none';
  }
}

function setBadge(ok){
  document.getElementById('cbadge').className = ok ? 'ok' : 'bad';
  document.getElementById('cbtxt').textContent = ok ? 'Calibrated' : 'Not Calibrated';
}

// â”€â”€â”€ CANVAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let cvs,ctx,cW,cH;

function initCvs(){
  const pan=document.getElementById('cvp');
  cvs=document.getElementById('cvs');
  ctx=cvs.getContext('2d');

  function resize(){
    cW=pan.clientWidth; cH=pan.clientHeight;
    // Canvas pixel buffer = CSS size Ã— DPR (for sharp rendering)
    cvs.width=cW*DPR; cvs.height=cH*DPR;
    cvs.style.width=cW+'px'; cvs.style.height=cH+'px';
    // Scale transform so we always draw in CSS pixels
    ctx.setTransform(DPR,0,0,DPR,0,0);
    draw();
  }
  resize();
  new ResizeObserver(resize).observe(pan);

  // Clone node to clear any stale listeners
  const nc=cvs.cloneNode(true);
  pan.replaceChild(nc,cvs);
  cvs=nc; ctx=cvs.getContext('2d');
  ctx.setTransform(DPR,0,0,DPR,0,0);

  cvs.addEventListener('mousedown', MD);
  cvs.addEventListener('mousemove', MM);
  cvs.addEventListener('mouseup',   MU);
  cvs.addEventListener('mouseleave',MU);
  cvs.addEventListener('touchstart',e=>{e.preventDefault();MD(e.touches[0]);},{passive:false});
  cvs.addEventListener('touchmove', e=>{e.preventDefault();MM(e.touches[0]);},{passive:false});
  cvs.addEventListener('touchend',  MU,{passive:false});

  syncAll(); draw();
}

const CX = () => cW / 2;
const CY = () => cH / 2;

// Radius in CSS pixels for canvas drawing.
// mppCSS = mm per CSS pixel (from credit card calibration: CARD_W_MM / card_width_px)
// radius_css_px = radius_mm / mppCSS
function rPx(){
  if(mppCSS && mppCSS > 0) return (diam / 2) / mppCSS;
  return Math.min(cW, cH) * 0.28;  // uncalibrated fallback only
}

function ePos(e){
  const r=cvs.getBoundingClientRect();
  return{x:e.clientX-r.left,y:e.clientY-r.top};
}
function dist(ax,ay,bx,by){return Math.sqrt((ax-bx)**2+(ay-by)**2);}

function nearHandle(x,y){return dist(x,y,CX(),CY()-rPx())<22;}
function nearEdge(x,y){return Math.abs(dist(x,y,CX(),CY())-rPx())<22;}

function MD(e){
  const p=ePos(e);
  if(nearHandle(p.x,p.y)||nearEdge(p.x,p.y)){
    drag=true; dy0=p.y; d0=diam;
    cvs.style.cursor='grabbing';
  }
}
function MM(e){
  const p = ePos(e);
  if(drag){
    // deltaPx is CSS pixels (canvas coords are CSS px after setTransform).
    // Dragging UP (dy0 > p.y) = larger ring.
    const deltaCssPx = dy0 - p.y;
    // Step 5: convert CSS px delta â†’ mm using mppCSS
    // mppCSS = CARD_W_MM / card_width_px (from card calibration)
    const fallbackMppCSS = 25.4 / 96; // 96 CSS PPI fallback only if uncalibrated
    const deltaMm = deltaCssPx * (mppCSS || fallbackMppCSS);
    let nd = d0 + deltaMm * 2; // diameter = 2 Ã— radius change
    if(snap) nd = Math.round(nd * 2) / 2;
    nd = clamp(nd, 5, 40);
    diam = nd;
    syncAll(); draw();
  } else {
    cvs.style.cursor = (nearHandle(p.x, p.y) || nearEdge(p.x, p.y)) ? 'grab' : 'default';
  }
}
function MU(){drag=false;cvs.style.cursor='default';}

function draw(){
  if(!ctx||!cW) return;
  const W=cW,H=cH,cx=CX(),cy=CY(),r=rPx();
  ctx.clearRect(0,0,W,H);

  if(zoom){ctx.save();ctx.translate(cx,cy);ctx.scale(1.85,1.85);ctx.translate(-cx,-cy);}

  // Outer glow
  const gl=ctx.createRadialGradient(cx,cy,r*.5,cx,cy,r+50);
  gl.addColorStop(0,'rgba(201,168,76,0)');
  gl.addColorStop(.65,'rgba(201,168,76,0.07)');
  gl.addColorStop(1,'rgba(201,168,76,0)');
  ctx.fillStyle=gl; ctx.beginPath(); ctx.arc(cx,cy,r+50,0,Math.PI*2); ctx.fill();

  // Crosshair
  ctx.save();
  ctx.strokeStyle='rgba(201,168,76,0.18)'; ctx.lineWidth=1; ctx.setLineDash([5,8]);
  const e=r+60;
  ctx.beginPath();
  ctx.moveTo(cx,cy-e);ctx.lineTo(cx,cy+e);
  ctx.moveTo(cx-e,cy);ctx.lineTo(cx+e,cy);
  ctx.stroke(); ctx.setLineDash([]); ctx.restore();

  // Fill
  const fg=ctx.createRadialGradient(cx,cy,0,cx,cy,r);
  fg.addColorStop(0,'rgba(201,168,76,0.04)');
  fg.addColorStop(1,'rgba(201,168,76,0.07)');
  ctx.fillStyle=fg; ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fill();

  // Main ring stroke
  ctx.save();
  ctx.shadowColor='rgba(201,168,76,.6)'; ctx.shadowBlur=18;
  ctx.strokeStyle='#c9a84c'; ctx.lineWidth=2.5;
  ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.stroke();
  ctx.restore();

  // Inner dashed ring
  ctx.save();
  ctx.strokeStyle='rgba(201,168,76,.28)'; ctx.lineWidth=1; ctx.setLineDash([3,6]);
  ctx.beginPath(); ctx.arc(cx,cy,Math.max(4,r-10),0,Math.PI*2); ctx.stroke();
  ctx.setLineDash([]); ctx.restore();

  // Cardinal ticks
  ctx.save();
  ctx.strokeStyle='rgba(201,168,76,.65)'; ctx.lineWidth=2;
  [0,Math.PI/2,Math.PI,3*Math.PI/2].forEach(a=>{
    const c2=Math.cos(a),s2=Math.sin(a);
    ctx.beginPath();
    ctx.moveTo(cx+(r-11)*c2,cy+(r-11)*s2);
    ctx.lineTo(cx+(r+11)*c2,cy+(r+11)*s2);
    ctx.stroke();
  });
  ctx.restore();

  // Diameter label
  ctx.font = '600 13px "DM Sans",sans-serif';
  ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
  if(mppCSS){
    ctx.fillStyle = 'rgba(201,168,76,.88)';
    ctx.fillText('âŒ€ ' + diam.toFixed(2) + ' mm', cx, cy + r + 22);
  } else {
    ctx.fillStyle = 'rgba(201,168,76,.5)';
    ctx.fillText('Calibrate for accurate mm', cx, cy + r + 22);
  }

  // Center dot
  ctx.fillStyle='rgba(201,168,76,.5)';
  ctx.beginPath(); ctx.arc(cx,cy,3,0,Math.PI*2); ctx.fill();

  // Drag handle
  const hx=cx,hy=cy-r;
  ctx.save();
  ctx.shadowColor='rgba(201,168,76,.7)'; ctx.shadowBlur=12;
  ctx.fillStyle='#c9a84c'; ctx.beginPath(); ctx.arc(hx,hy,13,0,Math.PI*2); ctx.fill();
  ctx.restore();
  ctx.strokeStyle='#fff'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.arc(hx,hy,13,0,Math.PI*2); ctx.stroke();
  ctx.fillStyle='#fff'; ctx.font='bold 11px sans-serif';
  ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText('â†•',hx,hy);

  if(zoom) ctx.restore();
}

// â”€â”€â”€ CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setD(v){
  v=clamp(v,5,40);
  if(snap) v=Math.round(v*2)/2;
  diam=v; syncAll(); draw();
}
function nudge(d){setD(diam+d);}

function syncAll(){
  // â”€â”€ STEP 5: diameter_mm is our master value (diam).
  // It was either set by slider/nudge directly in mm,
  // or derived from drag via: deltaMm = deltaCssPx * mppCSS.
  // Either way, diam IS already in real mm â€” no further conversion needed here.
  const diameter_mm = diam;

  // â”€â”€ STEP 6: SANITY CHECKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // (only apply when calibrated â€” slider can explore freely when not calibrated)
  if(mppCSS){
    if(diameter_mm < 12){
      document.getElementById('warn-box').style.display = 'flex';
      document.getElementById('warn-msg').textContent   = 'Diameter ' + diameter_mm.toFixed(2) + 'mm is too small for a real ring (< 12mm). Adjust the circle or re-calibrate.';
    } else if(diameter_mm > 25){
      document.getElementById('warn-box').style.display = 'flex';
      document.getElementById('warn-msg').textContent   = 'Diameter ' + diameter_mm.toFixed(2) + 'mm is very large (> 25mm). Double-check your measurement.';
    } else {
      document.getElementById('warn-box').style.display = 'none';
    }
  } else {
    document.getElementById('warn-box').style.display = 'none';
  }

  // â”€â”€ STEP 7: CIRCUMFERENCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // circumference_mm = diameter_mm Ã— Ï€
  // Do NOT compute from pixels â€” compute only from diameter_mm.
  const circumference_mm = diameter_mm * Math.PI;

  // â”€â”€ STEP 8: RING SIZE CONVERSIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Indian size: circumference_mm - 40, round to nearest 0.5
  const indian_raw  = circumference_mm - 40;
  const indian_size = Math.round(indian_raw * 2) / 2;

  // US size: (diameter_mm - 11.63) / 0.8128, round to nearest 0.25
  const us_raw  = (diameter_mm - 11.63) / 0.8128;
  const us_size = Math.round(us_raw * 4) / 4;

  // UK/AU: lookup table (unchanged â€” most accurate via table)
  const s = sz(diameter_mm);

  // â”€â”€ SLIDER SYNC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const pct = (diameter_mm - 5) / (40 - 5) * 100;
  ['dsl', 'msl'].forEach(id => {
    const el = document.getElementById(id);
    if(!el) return;
    el.value = diameter_mm;
    el.style.setProperty('--p', pct + '%');
  });

  // â”€â”€ UI UPDATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  set('bn',   diameter_mm.toFixed(2));
  set('mn',   diameter_mm.toFixed(2));
  set('cv-d', diameter_mm.toFixed(2));
  set('md',   diameter_mm.toFixed(2));
  set('mr',   (diameter_mm / 2).toFixed(2));
  set('mc',   circumference_mm.toFixed(2));

  // Format US size as fraction string
  const us_str = formatUS(us_size);

  set('si', indian_size.toFixed(1));
  set('su', us_str);
  set('sk', s[3]);
  set('se', s[4]);

  // â”€â”€ DEBUG CONSOLE TRACE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if(mppCSS){
    // ring_diameter_px = diameter in CSS pixels (what canvas draws)
    const ring_diameter_px = diameter_mm / mppCSS;
    const _cd = typeof console.debug === 'function' ? console.debug.bind(console) : console.log.bind(console);
    _cd(
      '[Aurum Debug]',
      '\n  card_width_px          =', card_width_px ? card_width_px.toFixed(2) : 'n/a', 'CSS px',
      '\n  mm_per_pixel (mppCSS)  =', mppCSS.toFixed(6),
      '\n  ring_diameter_px       =', ring_diameter_px.toFixed(4), 'CSS px',
      '\n  diameter_mm_before_rounding =', diameter_mm.toFixed(6),
      '\n  circumference_mm       =', circumference_mm.toFixed(4),
      '\n  indian_size            =', indian_size,
      '\n  us_size                =', us_raw.toFixed(4), 'â†’', us_str,
    );
  }
}

// Format US ring size as proper fraction (e.g. 7.25 â†’ "7Â¼", 7.5 â†’ "7Â½", 7.75 â†’ "7Â¾")
function formatUS(v){
  if(v < 0) return '< 0';
  const whole = Math.floor(v);
  const frac  = Math.round((v - whole) * 4); // quarters
  const fracs = ['', 'Â¼', 'Â½', 'Â¾', ''];
  if(frac === 4) return (whole + 1).toString();
  return whole + (fracs[frac] || '');
}

function set(id, v){ const el = document.getElementById(id); if(el) el.textContent = v; }

// â”€â”€â”€ TOGGLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tSnap(){
  snap=!snap;
  document.getElementById('snaptg').classList.toggle('on',snap);
  toast(snap?'Snap 0.5mm on':'Snap off');
  if(snap) setD(diam); else draw();
}
function tZoom(){
  zoom=!zoom;
  document.getElementById('zoomtg').classList.toggle('on',zoom);
  document.getElementById('zbadge').style.display=zoom?'block':'none';
  toast(zoom?'2Ã— zoom on':'Zoom off');
  draw();
}

// â”€â”€â”€ DARK MODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SUNI='<path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 0 0-1.41 0 .996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 0 0-1.41 0 .996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 0 0 0-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 0 0 0-1.41.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 0 0 0-1.41.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>';
const MOONI='<path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/>';
function tDark(){
  const on=document.body.toggleAttribute('data-dark');
  localStorage.setItem('a_dark',on?'1':'');
  document.getElementById('dico').innerHTML=on?SUNI:MOONI;
  if(ctx) draw();
}

// â”€â”€â”€ EXPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function expImg(){
  const d=diam,s=sz(d);
  const EW=820,EH=540;
  const ec=document.createElement('canvas');
  ec.width=EW; ec.height=EH;
  const et=ec.getContext('2d');
  et.fillStyle='#faf7f0'; et.fillRect(0,0,EW,EH);
  const bg=et.createRadialGradient(EW*.5,EH*.5,20,EW*.5,EH*.5,350);
  bg.addColorStop(0,'rgba(201,168,76,.06)'); bg.addColorStop(1,'transparent');
  et.fillStyle=bg; et.fillRect(0,0,EW,EH);
  const RX=195,RY=EH/2,RR=145;
  et.save(); et.shadowColor='rgba(201,168,76,.45)'; et.shadowBlur=28;
  et.strokeStyle='#c9a84c'; et.lineWidth=3;
  et.beginPath(); et.arc(RX,RY,RR,0,Math.PI*2); et.stroke(); et.restore();
  et.strokeStyle='rgba(201,168,76,.25)'; et.lineWidth=1; et.setLineDash([3,5]);
  et.beginPath(); et.arc(RX,RY,RR-12,0,Math.PI*2); et.stroke(); et.setLineDash([]);
  et.fillStyle='rgba(201,168,76,.75)'; et.font='bold 13px sans-serif';
  et.textAlign='center'; et.textBaseline='middle';
  et.fillText('âŒ€ '+d.toFixed(2)+' mm',RX,RY);
  et.strokeStyle='rgba(201,168,76,.22)'; et.lineWidth=1;
  et.beginPath(); et.moveTo(370,48); et.lineTo(370,EH-48); et.stroke();
  et.fillStyle='#18120a'; et.textAlign='left'; et.textBaseline='top';
  et.font='bold 25px Georgia,serif'; et.fillText('AURUM SIZER',400,50);
  et.fillStyle='#8a7055'; et.font='13px sans-serif';
  et.fillText('Ring Size Report Â· '+new Date().toLocaleDateString(),400,82);
  et.strokeStyle='rgba(201,168,76,.28)'; et.lineWidth=.8;
  et.beginPath(); et.moveTo(400,104); et.lineTo(EW-40,104); et.stroke();
  const rows=[['Diameter',d.toFixed(2)+' mm'],['Radius',(d/2).toFixed(2)+' mm'],
    ['Circumference',(Math.PI*d).toFixed(2)+' mm'],[null,null],
    ['Indian',s[1]],['US/Canada',s[2]],['UK/AUS',s[3]],['EU/ISO',s[4]]];
  let ry=122;
  rows.forEach(([l,v])=>{
    if(!l){ry+=8;et.strokeStyle='rgba(201,168,76,.14)';et.lineWidth=.6;
      et.beginPath();et.moveTo(400,ry);et.lineTo(EW-40,ry);et.stroke();ry+=10;return;}
    et.fillStyle='#8a7055';et.font='12px sans-serif';et.textAlign='left';et.textBaseline='middle';et.fillText(l,400,ry);
    et.fillStyle='#c9a84c';et.font='bold 17px Georgia,serif';et.textAlign='right';et.fillText(v,EW-40,ry);
    et.strokeStyle='rgba(201,168,76,.08)';et.lineWidth=.5;
    et.beginPath();et.moveTo(400,ry+11);et.lineTo(EW-40,ry+11);et.stroke();ry+=32;
  });
  et.fillStyle='rgba(201,168,76,.45)';et.font='10px sans-serif';et.textAlign='center';et.textBaseline='bottom';
  et.fillText('Aurum Sizer â€” Professional Ring Measurement Tool',EW/2,EH-12);
  const a=document.createElement('a');
  a.download='ring-size-'+d.toFixed(1)+'mm.png';
  a.href=ec.toDataURL('image/png');a.click();
  toast('âœ“ Image saved');
}

function expPDF(){
  const d=diam,s=sz(d);
  const dt=new Date().toLocaleDateString('en-IN',{year:'numeric',month:'long',day:'numeric'});
  const html=`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Ring Size Report</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;500&family=DM+Sans:wght@400;600&display=swap" rel="stylesheet">
<style>*{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#faf7f0;color:#18120a;padding:48px;max-width:560px;margin:auto}h1{font-family:'Cormorant Garamond',serif;font-size:36px;font-weight:300;margin-bottom:4px}h1 b{color:#c9a84c}.sub{font-size:13px;color:#8a7055;margin-bottom:26px}hr{border:none;border-top:1px solid rgba(201,168,76,.25);margin:20px 0}.lbl{font-size:10px;font-weight:700;letter-spacing:.18em;text-transform:uppercase;color:#c9a84c;margin-bottom:10px}table{width:100%;border-collapse:collapse}td{padding:9px 0;border-bottom:1px solid rgba(201,168,76,.1);font-size:14px;color:#8a7055}td:last-child{text-align:right;font-family:'Cormorant Garamond',serif;font-size:21px;font-weight:500;color:#18120a}footer{margin-top:32px;font-size:11px;color:rgba(201,168,76,.5);text-align:center}</style>
</head><body>
<h1>AURUM <b>SIZER</b></h1><p class="sub">Ring Size Report &middot; ${dt}</p><hr>
<div class="lbl">Measurements</div>
<table><tr><td>Diameter</td><td>${d.toFixed(2)} mm</td></tr><tr><td>Radius</td><td>${(d/2).toFixed(2)} mm</td></tr><tr><td>Circumference</td><td>${(Math.PI*d).toFixed(2)} mm</td></tr></table><hr>
<div class="lbl">Ring Sizes</div>
<table><tr><td>Indian</td><td>${s[1]}</td></tr><tr><td>US / Canada</td><td>${s[2]}</td></tr><tr><td>UK / Australia</td><td>${s[3]}</td></tr><tr><td>EU / ISO</td><td>${s[4]}</td></tr></table>
<footer>Aurum Sizer &middot; Accuracy within &plusmn;0.3mm with proper calibration</footer>
</body></html>`;
  const blob=new Blob([html],{type:'text/html'});
  const url=URL.createObjectURL(blob);
  const w=window.open(url,'_blank');
  if(w){w.onload=()=>w.print();toast('PDF ready â€” Print â†’ Save as PDF');}
  else toast('âš  Allow popups to save PDF');
}

function cpLink(){
  const u = new URL(location.href);
  u.searchParams.set('d', diam.toFixed(2));
  if(mppCSS) u.searchParams.set('mpp', mppCSS.toFixed(8));
  navigator.clipboard.writeText(u.toString())
    .then(() => toast('âœ“ Link copied!'))
    .catch(() => prompt('Copy:', u.toString()));
}

// â”€â”€â”€ FULLSCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tFS(){
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen()
      .then(()=>{document.getElementById('fsbar').classList.remove('on');toast('âœ“ Fullscreen');})
      .catch(()=>toast('âš  Fullscreen unavailable'));
  }else{
    document.exitFullscreen().then(()=>toast('Exited fullscreen'));
  }
}

// â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _tt;
function toast(msg){
  const el=document.getElementById('toast');
  el.textContent=msg; el.classList.add('on');
  clearTimeout(_tt); _tt=setTimeout(()=>el.classList.remove('on'),2800);
}

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function clamp(v,lo,hi){return Math.max(lo,Math.min(hi,v));}

// â”€â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function boot(){
  // Restore theme
  if(localStorage.getItem('a_dark') === '1'){
    document.body.setAttribute('data-dark', '');
    document.getElementById('dico').innerHTML = SUNI;
  }

  // Handle shared link (?d=18.5&mpp=0.1657)
  const p = new URLSearchParams(location.search);
  if(p.has('d')){
    const sd = parseFloat(p.get('d'));
    if(sd > 0){
      diam = sd;
      if(p.has('mpp')){
        mppCSS = parseFloat(p.get('mpp'));
        localStorage.setItem('a_mppCSS', mppCSS);
      }
      setBadge(!!mppCSS);
      document.querySelectorAll('.scr').forEach(s => s.classList.remove('on'));
      document.getElementById('s-meas').classList.add('on');
      setTimeout(initCvs, 50);
      document.getElementById('fsbar').classList.add('on');
      document.getElementById('nocal-overlay').classList.toggle('hide', !!mppCSS);
      return;
    }
  }
  chkSaved();
})();
</script>
</body>
</html>
